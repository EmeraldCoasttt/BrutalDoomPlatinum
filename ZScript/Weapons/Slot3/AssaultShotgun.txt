class ASGShield : Ammo
{
	Default
	{
		Inventory.PickupMessage "$GOTCLIP";
		Inventory.Amount 0;
		Inventory.MaxAmount 100;
		Inventory.Icon "ASGSA0";
		Tag "$AMMO_CLIP";
	}
}



class BDPAssaultShotgun : BDPWeaponBase
{
	int burstCount;
	bool shieldready;
	bool shieldwasactive;
	bool shieldbroken;
	int shieldtimer;
	int rechargetimer;
	bool hasbeenpickedup;
	int ShieldFrame;
	
	Default
	{
		Weapon.AmmoGive 8;
		Weapon.SlotNumber 3;
		Weapon.SlotPriority 3;
		Weapon.SelectionOrder 1200;
		Weapon.AmmoType "BDPShell";
		Weapon.AmmoType2 "ASGShield";
		BDPWeaponBase.MagCapacity 15;
		Obituary "%o was shot down by %k's Assault Shotgun.";
		AttackSound "None";
		Inventory.PickupSound "ASGSEL";
		Inventory.Pickupmessage "You got the Assault Shotgun! (Slot 3)";
		Tag "$BDPASG";
		Inventory.AltHUDIcon "A12PA0";
	}
	override void DoEffect() 
	{
		super.DoEffect();
		If(owner.player && owner.player.readyweapon is "BDPAssaultShotgun" && owner.player.cmd.buttons & BT_ALTATTACK && shieldready && countinv("ASGShield") > 0)
		{
			owner.Player.SetPSprite(-14,resolvestate("ASGShield"));
			If(!shieldwasactive)
			{
				owner.Player.SetPSprite(-14,resolvestate("ASGShieldBash"));
				owner.A_startsound("ASGSHLD3",234);
			}
			shieldwasactive = true;
			asgshieldactive = true;
			owner.bnoblood = true;
			
			//console.printf("Shield active wooo");
		}
		else if(owner.player)
		{
			asgshieldactive = false;
			owner.bnoblood = false;
			If(shieldwasactive)
			{
				owner.Player.SetPSprite(-14,resolvestate("ShieldBreak"));
				owner.A_startsound("ASGSHLD4",234);
				owner.a_startsound("StickyGrenade/Hit",125,0,0.5);
				Shieldtimer = 35;
				shieldready = false;
				If(countinv("ASGShield") < 1)
				{
					shieldbroken = true;
					owner.A_startsound("ASGSHLD1",234);
				}
				shieldwasactive = false;
				ChangeAmmoIcon2("ASGSB0");
			}
			If(shieldtimer > 0)
			{
				shieldtimer--;
			}
			Else if(!shieldbroken && !shieldready)
			{
				shieldready = true;
				
				If(owner.player && owner.player.readyweapon is "BDPAssaultShotgun")
					{
						ChangeAmmoIcon2("ASGSA0");
						owner.A_startsound("ASGSHLD",233);
						
					}
			}
			If(ShieldTimer < 1)
			{
				If(rechargetimer < 5)
				{
					rechargetimer++;
				}
				Else if(countinv("ASGShield") < 100)
				{
					rechargetimer = 0;
					giveinventory("ASGShield",1);
				}
				Else if(shieldbroken)
				{
					ShieldBroken = false;
					ShieldReady = true;
					ChangeAmmoIcon2("ASGSA0");
					If(owner.player && owner.player.readyweapon is "BDPAssaultShotgun")
					{
						owner.A_startsound("ASGSHLD",233);
					}
				}
			}
			
			
		}
	}
	States
	{
	Grenade: //30
		A12S BCDE 1;
		TNT1 A 22;
		A12S EDCB 1;
		Goto Ready;
	Kick: //18
		A12G BCDE 1;
		A12G F 10;
		A12G EDCB 1;
		Goto Ready;
	SlideKick: //25
		A12G BCDE 1;
		A12G F 17;
		A12G EDCB 1;
		Goto Ready;
	Taunt: //30
		A12G BCDE 1;
		A12G F 22;
		A12G EDCB 1;
		Goto Ready;
	Sprint:
		A12G BCDE 1 A_SetSprites("TNT1A0",1);
	SprintLoop:
		A12G F 1 A_SetSprites("TNT1A0",1);
		Loop;
	SprintEnd:
		A12G EDCB 1 A_SetSprites("TNT1A0",1);
		Stop;
	Ready:
		A12G A 1 A_WeaponReadyDX(WRF_ALLOWRELOAD|WRF_NOSECONDARY);
		Loop;
	Deselect:
		A12S ABCDE 1;
		TNT1 A 1;
		TNT1 A 0 ChangeAmmoIcon1("SHELA0");
		TNT1 A 0 A_Lower();
		Wait;
	Select:
		TNT1 A 1
		{ 
			if (countinv("PLasmaShellSelected")==1)
			{
				A_SetCrosshairDX("ASGRet",650);
				ChangeAmmoIcon1("SHEL[0");
			}
			else
			{
				A_SetCrosshairDX("SGUNRet", 600);
			}
			A_GunslingerMag();
			invoker.burstCount = 0;
		}
		TNT1 A 0 A_StartSound("ASGSEL");
		A12S EDCBA 1 A_WeaponReady(WRF_NOFIRE);
		Goto Ready;
	ASGShieldBash:
		PSHL E 0 A_FireProjectile("ShieldBash");
	ASGShield:
		TNT1 A 0 
		{
			If(random(0,1) == 1)
				{
					A_OverlayFlags(-14,PSPF_FLIP,true);
				}
				Else
				{
					A_OverlayFlags(-14,PSPF_FLIP,false);
				}
				A_OverlayFlags(-14,PSPF_RENDERSTYLE|PSPF_FORCESTYLE,true);
				A_OverlayRenderStyle(-14,STYLE_Add);
		}
		TNT1 A 0 A_JumpIf(Invoker.ShieldFrame > 0,"ASGShield2");
		PSHL A 1 BRIGHT {invoker.ShieldFrame++;}
		STOP;
	ASGShield2:
		TNT1 A 0 A_JumpIf(Invoker.ShieldFrame > 1,"ASGShield3");
		PSHL B 1 BRIGHT {invoker.ShieldFrame++;}
		STOP;
	ASGShield3:
		TNT1 A 0 A_JumpIf(Invoker.ShieldFrame > 2,"ASGShield4");
		PSHL C 1 BRIGHT {invoker.ShieldFrame++;}
		STOP;
	ASGShield4:
		TNT1 A 0 A_JumpIf(Invoker.ShieldFrame > 3,"ASGShield5");
		PSHL D 1 BRIGHT {invoker.ShieldFrame++;}
		STOP;
	ASGShield5:
		TNT1 A 0 A_JumpIf(Invoker.ShieldFrame > 4,"ASGShield6");
		PSHL E 1 BRIGHT {invoker.ShieldFrame++;}
		STOP;
	ASGShield6:
		TNT1 A 0 A_JumpIf(Invoker.ShieldFrame > 5,"ASGShield7");
		PSHL F 1 BRIGHT {invoker.ShieldFrame++;}
		STOP;
	ASGShield7:
		TNT1 A 0 A_JumpIf(Invoker.ShieldFrame > 6,"ASGShield8");
		PSHL G 1 BRIGHT {invoker.ShieldFrame++;}
		STOP;
	ASGShield8:
		PSHL H 1 BRIGHT {invoker.ShieldFrame = 0;}
		STOP;
	ShieldBreak:
		PSHL A 0 A_FireShieldParticles();
		STOP;
	MuzzleFlash:
		A12M B 0;
		A12M A 1 Bright A_SetFrame(random(0,1),-1);
		Stop;
	 Fire:
		TNT1 A 0 A_CheckIfMag();
		TNT1 A 0 A_JumpIf(Countinv("PlasmaShellSelected")==1,"FireEnergy");
		A12F A 1 Bright
		{
			A_FireBullets (3, 3, 5, 10, "MachineGunBulletPuff", FBF_NORANDOM,8192,"decorativetracer",-7);
			A_FireBullets (1.5, 1.5, 4, 6, "ShotgunPuff", FBF_NORANDOM,400,"decorativetracer",-7);
			A_FlashOverlay();
			A_WeaponRecoil(8,frandom(-4,4),2,0.75);
			A_WeaponOffset(random(-1,1),32+random(0,1));
			A_FireParticles(8);
			A_StartSound("A12FIR", 1,0,0.6);
			A_StartSound("FARSHT", 6);
			A_AlertMonstersDX();
			A_ZoomFactor(0.99);
			A_QuadSound();
			A_GunLight();
			A_TakeMag();
		}
		A12F C 1 {A_FireProjectile("ShotCaseSpawn",5,0,6,-14); A_ZoomFactor(1.0);}
		A12F CDEFG 1;
		A12G A 1 A_WeaponOffset(0,32);
		TNT1 A 0 A_RefireDX();
		Goto Ready;
	FireEnergy:
		A12F A 1 Bright
		{
			for(int i = 0; i < 23; i++)
			{
				A_FireProjectile("DragonsBreathSparkle",frandom(-3 - invoker.burstCount,3 + invoker.burstCount),false,0,-4,0,frandom(-3 - invoker.burstCount,3 + invoker.burstCount));
			}
			A_FlashOverlay();
			A_WeaponRecoil(8,frandom(-4,4),2,0.75);
			A_WeaponOffset(random(-1,1),32+random(0,1));
			A_FireParticles(8);
			A_StartSound("A12FIR", 1,0,0.6);
			A_StartSound("FARSHT", 6);
			A_AlertMonstersDX();
			A_ZoomFactor(0.99);
			A_QuadSound();
			A_GunLight();
			A_TakeMag();
			invoker.burstCount++;
			if(invoker.burstCount == 3)
			{
				A_SemiFlag();
			}
		}
		A12F C 1 {A_FireProjectile("DragonShotCaseSpawn",5,0,6,-14); A_ZoomFactor(1.0);}
		A12F CDEFG 1;
		TNT1 A 0 A_JumpIf(invoker.burstCount < 3, "Fire");
		A12G A 1 {invoker.burstCount = 0; A_WeaponOffset(0,32);}
		TNT1 A 0 A_SemiRefire();
		Goto Ready;
	Fidget:
		A12R ABCD 1 A_WeaponReadyDX(WRF_NOSECONDARY,false);
		212G A 0 A_JumpIf(Countinv("PlasmaShellSelected")==1, 2);
		A12G A 0;
		"####" A 0;
		"####" T 1 A_WeaponReadyDX(WRF_NOSECONDARY,false);
	FidgetLoop:
		"####" GGGGHIJK 1 A_WeaponReadyDX(WRF_NOSECONDARY,false);
		"####" X 0 A_StartSound("ASGINSP",1);
		"####" L 6 A_WeaponReadyDX(WRF_NOSECONDARY,false);
		"####" MNOONNOONNNOOO 1 A_WeaponReadyDX(WRF_NOSECONDARY,false);
		"####" A 0 A_StopSound(1);
		"####" PQRSGGG 1 A_WeaponReadyDX(WRF_NOSECONDARY,false);
		"####" A 0 A_PressingReload("FidgetLoop");
		"####" X 0 A_StartSound("foley/ASGPump", 10);
		"####" T 1 A_WeaponReadyDX(WRF_NOSECONDARY,false);
		A12R DCBA 1 A_WeaponReadyDX(WRF_NOSECONDARY,false);
		Goto Ready;
	DoReload:
		A12G A 1;
		A12R ABC 1;
		212R A 0 A_JumpIf(Countinv("PlasmaShellSelected")==1, 2);
		A12R A 0;
		"####" D 4;
		21R1 A 0 A_JumpIf(Countinv("PlasmaShellSelected")==1, 2);
		A1R1 A 0;
		"####" DEFFGGG 1;
		"####" A 0 A_StartSound("DryFire");
		"####" G 2 offset(0,34);
		"####" G 1 offset(0,33);
		"####" A 0 A_StartSound("ASGREL1", 1);
		"####" A 0 A_StartSound("foley/ASGDrumOut", 10,0,0.7);
		"####" A 0 A_DiscardMag();
		"####" H 1 offset(0,32);
		A1R1 IJ 1;
		TNT1 A 0 A_FireProjectile("EmptyASGDrumSpawn",180,0,-4,-10);
		A12R G 3;
		TNT1 A 0 A_StartSound("foley/ShotgunReloadRaise", 10);
	ContinueReload:
		A12R HIJKKKKKLM 1;
		212R A 0 A_JumpIf(Countinv("PlasmaShellSelected")==1, 2);
		A12R A 0;
		"####" NOOPQRS 1;
		"####" T 3;
		TNT1 A 0 A_StartSound("PISTFOL5", 10);
		21R1 A 0 A_JumpIf(Countinv("PlasmaShellSelected")==1, 2);
		A1R1 A 0;
		"####" ABCCA 1;
		TNT1 A 0 A_CheckIfMag(1,"ReloadEmpty");
		NULL A 0
		{
			A_StartSound("ASGREL2", 1);
			A_ReloadMag(1);
			if(Countinv("PlasmaShellSelected")==1)
			{
				ChangeAmmoIcon1("SHEL[0");
				ChangeWeaponIcon("A12PB0");
				A_SetCrosshairDX("ASGRet",650);
			}
			else
			{
				ChangeAmmoIcon1("SHELA0");
				ChangeWeaponIcon("A12PA0");
				A_SetCrosshairDX("SGUNRet",600);
			}
		}
		A12R UWWX 1;
		A12R Y 1 A_StartSound("foley/ASGBuckshot", 11);
		A12R Z 12;
		TNT1 A 0 A_StartSound("foley/ASGPump", 10);
		A12R "[\]CBA" 1;
		Goto Ready;
	ReloadEmpty:
		TNT1 A 0
		{
			A_PlaySound("ASGREL2", 1);
			A_ReloadMag(1);
			if(Countinv("PlasmaShellSelected")==1)
			{
				ChangeAmmoIcon1("SHEL[0");
				ChangeWeaponIcon("A12PB0");
				A_SetCrosshairDX("ASGRet",650);
			}
			else
			{
				ChangeAmmoIcon1("SHELA0");
				ChangeWeaponIcon("A12PA0");
				A_SetCrosshairDX("SGUNRet",600);
			}
		}
		A12R UWWX 1;
		A12R Y 1 A_StartSound("foley/ASGBuckshot", 11);
		A12R Z 12;
		TNT1 A 0 A_PlaySound("foley/ASGPump", 10);
		A12R "[\]" 1;
		A12R CBA 1;
		A12G A 6;
		A12G A 0 A_PlaySound("ASGPUMP1", 1);
		A1R1 K 1;
		A1R1 M 1 offset(0,33);
		A1R1 M 6 offset(0,32);
		A1R1 L 1;
		A12G A 1 offset(0,33);
		A12G A 3 offset(0,32);
		Goto Ready;
	SpecialAction:
		A12G A 0 A_TakeInventory("StartDualWield",1);
		TNT1 A 0 A_CheckIfAmmo("BDPShell");
		TNT1 A 0
		{
			if(Countinv("PlasmaShellSelected")==1)
			{
				A_Print("\cgBuckshot",2);
				A_takeinventory("PlasmaShellSelected",1);
			}
			else
			{
				A_Print("\ciDragon's Breath",2);
				A_giveinventory("PlasmaShellSelected",1);
			}
		}
		TNT1 A 0 A_CheckIfMag(1,"ReloadSwapAmmo");
		TNT1 A 0 A_StartSound("foley/ShotgunReloadRaise", 10);
		A12R ABGHIJKKLM 1;
		212R A 0 A_JumpIf(Countinv("PlasmaShellSelected")==1, 2);
		A12R A 0;
		"####" NOOPRT 1;
		TNT1 A 0
		{
			A_StartSound("ASGREL2", 1);
			if(Countinv("PlasmaShellSelected")==1)
			{
				ChangeAmmoIcon1("SHEL[0");
				ChangeWeaponIcon("A12PB0");
				A_SetCrosshairDX("ASGRet",650);
			}
			else
			{
				ChangeAmmoIcon1("SHELA0");
				ChangeWeaponIcon("A12PA0");
				A_SetCrosshairDX("SGUNRet",600);
			}
		}
		A12R UWWX 1;
		A12R Y 1 A_StartSound("foley/ASGBuckshot", 11);
		A12R Z 3;
		TNT1 A 0 A_StartSound("foley/ASGPump", 10);
		A12R "[\]CBA" 1;
		Goto Ready;
	ReloadSwapAmmo:
		A12G A 1;
		A12R ABC 1;
		212R A 0 A_JumpIf(Countinv("PlasmaShellSelected")==0, 2);
		A12R A 0;
		"####" D 4;
		21R1 A 0 A_JumpIf(Countinv("PlasmaShellSelected")==0, 2);
		A1R1 A 0;
		"####" DEFFGGG 1;
		"####" A 0 A_StartSound("DryFire");
		"####" G 2 offset(0,34);
		"####" G 1 offset(0,33);
		"####" A 0 A_StartSound("ASGREL1", 1);
		"####" A 0 A_StartSound("foley/ASGDrumOut", 10,0,0.7);
		"####" A 0 A_DiscardMag();
		"####" H 1 offset(0,32);
		A1R1 IJ 1;
		TNT1 A 0 A_FireProjectile("EmptyASGDrumSpawn",180,0,-4,-10);
		A12R G 3;
		TNT1 A 0 A_StartSound("foley/ShotgunReloadRaise", 10);
		Goto ContinueReload;
	Spawn:
		TNT1 A 0 NoDelay A_Jump(80,"Spawn2");
		A12P A -1;
		Stop;
	Spawn2:
		A12P B -1;
		Stop;
	 /*Fire2: //Aiming DOwn the Sights
		A12A E 1 Bright A_AlertMonstersDX
		//RIFF A 0 A_FireProjectile("GunFireSmoke", 0, 0, 0, 0, 0, 0)
		A12G A 0 A_SpawnItemEx("PlayerMuzzle1",30,5,30)
		A12F A 0 Bright A_FireBullets (3.75, 3.75, 9, 13, "MachineGunBulletPuff", FBF_NORANDOM)
		RIFF AAAAAAAA 0 A_FireProjectile("DecorativeTracer", random(-4,4), 0, -1, -12, 0, random(-4,4))
		A12G A 0 A_SetPitch(pitch-3, SPF_INTERPOLATE)
		TNT1 A 0 A_SetANgle(angle+random(-2, 2), SPF_INTERPOLATE)
		A12G A 0 A_ZoomFactor(1.25)
		A12G A 0
		A12G A 0
		A12G A 0 A_Takeinventory("AssaultShotgunAmmo",1)
		A12A F 1 A_FireProjectile("ShotCaseSpawn",5,0,6,0)
		A12A F 1 A_SetPitch(+0.6 + pitch, SPF_INTERPOLATE)
		A12G A 0 A_ZoomFactor(1.3)
		A12A GG 1 A_SetPitch(+0.6 + pitch, SPF_INTERPOLATE)
		A12A DD 1 A_SetPitch(+0.6 + pitch, SPF_INTERPOLATE)
		A12A D 1 
//		A12A A 0 A_JumpIfInventory("Aiming1",1,"HoldEnd1")
//		A12A A 0 A_JumpIfInventory("Aiming0",1,"HoldEnd")
//		A12A A 0 A_JumpIfInventory("FiredSecondary",1,"HoldAim")
		A12G A 0 //A_Refire
//		Goto NoAim 
	HoldEnd1: //For Pressed Once mode
		A12G A 0 A_JumpIfInventory("PressedOnce",1,"HoldDown1")
		Goto Ready2
	HoldDown1:
		A12G A 0 A_JumpIfInventory("PressedTwice",1,"NoAim")
		Goto Ready2
		
	HoldEnd: //For BDv21 mode
		A12G A 0 A_JumpIfInventory("PressedTwice",1,"HoldDown")
		A12G A 0 A_JumpIfInventory("Fire2Activate",1,"HoldDown")
//		Goto HoldAim1
	HoldDown:
		A12G A 0 A_Giveinventory("PressedTwice",1)
		A12G A 0 A_JumpIfInventory("FiredSecondary",1,"HoldAim")
//		Goto NoAim
		
	
	AltFire:
		A12G A 0 ACS_NamedExecuteAlways("HoldAim")
		A12G A 0 A_SetCrosshair(41)
		A12G A 0 A_Giveinventory("GoSpecial",1)
		A12G A 0 A_JumpIfInventory("Zoomed",1,"NoAim")
		A12G A 0 A_Giveinventory("Zoomed",1)
		A12G A 0 A_ZoomFactor(1.3)
		A12G A 0 A_Giveinventory("ADSmode",1)
		A12G A 0 A_Giveinventory("ZoomHold",1)
		SMGG A 0 A_StartSound("ADSIN")
		A12A ABC 1
		A12A D 2
		A12G A 0 A_TakeInventory("Fire2Activate",1)
		A12G A 0 A_Takeinventory("PressedTwice",1)
		
		A12G A 0 A_JumpIfInventory("Aiming0",1,"HoldAim1")
		A12G A 0 A_TakeInventory("PressedOnce",1)
		
		A12G A 0 A_JumpIfInventory("Aiming1",1,"Ready2")
		A12G A 0 A_JumpIfInventory("FiredSecondary",1,"HoldAim")
	
	HoldAim:	
		A12G A 0 A_JumpIfInventory("FiredPrimary",1,"Fire")
		A12A D 1 A_WeaponReady(WRF_ALLOWRELOAD)
		A12G A 0 A_JumpIfInventory("FiredPrimary",1,"Fire")
		A12A D 1 A_WeaponReady(WRF_ALLOWRELOAD)
		A12G A 0 A_JumpIfInventory("FiredPrimary",1,"Fire")
		A12A D 1 A_WeaponReady(WRF_ALLOWRELOAD)
		A12G A 0 A_JumpIfInventory("FiredPrimary",1,"Fire")
		
		A12G A 0 A_JumpIfInventory("FiredSecondary",1,"HoldAim")
		Goto NoAim
		
	HoldAim1:
		A12G A 0 A_JumpIfInventory("FiredPrimary",1,"Fire")
		A12A D 1 A_WeaponReady(WRF_ALLOWRELOAD)
		A12G A 0 A_JumpIfInventory("FiredPrimary",1,"Fire")
		A12A D 1 A_WeaponReady(WRF_ALLOWRELOAD)
		A12G A 0 A_JumpIfInventory("FiredPrimary",1,"Fire")
		A12A D 1 A_WeaponReady(WRF_ALLOWRELOAD)
		
		A12G A 0 A_TakeInventory("PressedOnce",1)
		A12G A 0 A_JumpIfInventory("FiredSecondary",1,"HoldAim")
		Goto Ready2
		
		NoAim:
		A12G A 0 A_Takeinventory("Zoomed",1)
		A12G A 0 A_Takeinventory("ZoomHold",1)
		A12G A 0 A_ZoomFactor(1.0)
		TNT1 A 0 {if(GetCVAR("bd_SmartCrosshairs") == 1){A_SetCrosshair(GetCVAR("ASGCrosshair"));}else{A_SetCrosshair(0);}}
		A12G A 0 A_Takeinventory("ADSmode",1)
		A12G A 0 A_TakeInventory("Fire2Activate",1)
		A12G A 0 A_Takeinventory("PressedTwice",1)
		A12G A 0 A_TakeInventory("PressedOnce",1)
		SMGG A 0 A_StartSound("ADSOUT")
		A12A CBA 1
		Goto Ready3
	
*/	
	}
}

//Emerald's plasma stuff wooo

/*Actor EnergyShellTrail
{
	
		+NOBLOCKMAP
		+NOGRAVITY
		+NOTELEPORT
		+CANNOTPUSH
		+NODAMAGETHRUST
		renderstyle "add"
		Alpha 1.0
		scale 0.2
		// translation "192:207=[153,50,204]:[0,0,0]"
	
	States
	{
		Spawn:
		 PLSS AAAABBBB 1 Bright A_FadeOut(0.04)
			LOOP
	}
}*/