class BDPGrenadeLauncher : BrutalWeapon
{
	bool thermiteGrenades;
	
	Default
	{
		Weapon.AmmoGive 2;
		Weapon.AmmoType "BDPRocketAmmo";
		BrutalWeapon.MagCapacity 1;
		Inventory.PickupSound "ROCKPKUP";
		Weapon.SlotNumber 5;
		Weapon.SlotPriority 2;
		Weapon.SelectionOrder 2700;
		Inventory.PickupMessage "You got the Grenade Launcher! (Slot 5)";
		+WEAPON.EXPLOSIVE
		Tag "$BDPGRENADE";
		Inventory.AltHUDIcon "GLAPA0";
	}
	States
	{
	Grenade: //32
		GLSA ABCD 1;
		TNT1 A 24;
		GLSA EDCB 1;
		Goto Ready;
	Kick: //16
		GLR1 BCDE 1;
		GLR1 F 8;
		GLR1 EDCB 1;
		Goto Ready;
	AirKick: //18
		GLAN BCDE 1;
		GLAN F 10;
		GLAN EDCB 1;
		Goto Ready;
	SlideKick: //26
		GLAN BCDE 1;
		GLAN F 18;
		GLAN EDCB 1;
		Goto Ready;
	Taunt: //30
		GLAN BCDE 1;
		GLAN F 22;
		GLAN EDCB 1;
		Goto Ready;
	Sprint:
		GLAN BCDE 1 A_WeaponReadyDX(WRF_ALLOWRELOAD,FALSE,FALSE);
	SprintLoop:
		GLAN F 1 A_KeepSprinting(WRF_ALLOWRELOAD);
		Loop;
	SprintEnd:
		GLAN EDCB 1 A_WeaponReadyDX(WRF_ALLOWRELOAD,FALSE,FALSE);
		Goto Ready;
	StrapIdle:
		SHTN A 0 A_JumpIfInventory("NoShotgunStrap",1,"Ready");
		GLR3 FEDCBAGHIJKLLLKJIHGABCDDDCBAGHIJJJIHG 1
		{
			if(invoker.mag < 1)
			{
				return A_AutoReloadMag(1,"Reload",true);
			}
			else
			{
				return A_WeaponReadyDX(WRF_ALLOWRELOAD);
			}
		}
		Goto Ready;
	Ready:
		GLAN A 1 A_WeaponReadyDX(WRF_ALLOWRELOAD);
		TNT1 A 0 A_AutoReloadMag(1,"Reload",true);
		Goto Ready;
	Deselect:
		GLR3 N 1;
		GLSA BCDE 1;
		TNT1 A 1;
		TNT1 A 0 ChangeAmmoIcon1("ROCKA0");
		TNT1 A 0 A_Lower();
		Wait;
	Select:
		TNT1 A 1
		{
			A_SetCrosshairDX("NadeRet", 500, 0.7);
			A_GunslingerMag();
			if(invoker.thermiteGrenades)
			{
				ChangeAmmoIcon1("ROCKE0");
			}
		}
		TNT1 A 0 A_StartSound("ROCKPKUP");
		GLSA EDCB 1 A_WeaponReady(WRF_NOFIRE);
		GLR3 M 1 A_WeaponReady(WRF_NOFIRE);
		Goto StrapIdle;
	Fire:
		TNT1 A 0 A_CheckIfMag();
		GLAF A 1 Bright 
		{
			if(invoker.thermiteGrenades)
			{
				A_FireProjectile("FireGrenade", 0, 0, 0, 0);
			}
			else
			{
				A_FireProjectile("GrenadeDetonates", 0, 0, 0, 0);
			}
			A_FireProjectile("RedFlareSpawn",-5,0,0,0);
			A_FireProjectile("GrenadeMissileBreaksGlass", 0, 0, 0, 0);
			A_FireParticles(7);
			A_StartSound("weapons/firegrenade", 1);
			A_AlertMonstersDX();
			A_ZoomFactor(0.98);
			A_QuadSound();
			A_GunLight();
			A_TakeMag(1,true,true);
			A_ZoomFactor(1.0);
			A_Recoil(1*cos(pitch));
			if(momZ != 0)
			{
				ThrustThingZ(0,pitch/3,0,1);
			}
			else
			{
				ThrustThingZ(0,pitch/4,0,1);
			}
			A_SetPitch(pitch-10, SPF_INTERPOLATE);
		}
		GLAF F 1 Bright 
		{
			A_GunLight();
			A_SetPitch(2 + pitch, SPF_INTERPOLATE);
		}
		GLAF EDCB 1 A_SetPitch(2 + pitch, SPF_INTERPOLATE);
		GLR3 C 1;
		TNT1 A 0
		{
			If(!invoker.thermiteGrenades)
			{
				A_Refire("SemiAutoLol");
			}
		}
		GLAN A 2 A_WeaponReady(WRF_NOFIRE|WRF_NOBOB);
		Goto NoAmmo2;
	SemiAutoLol:
		GLAN A 1;
		TNT1 A 0 A_Refire("SemiAutoLol");
		Goto NoAmmo2;
	ReloadSmoke:
		SSGS MNOPQR 1;
		stop;
	Reload:
		TNT1 A 0 A_JumpIfInventory("PowerSpeed2",1,"ReloadHaste");
		GLR1 ABCDEFGGGG 1;
		TNT1 A 0 A_StartSound("foley/GLDownwardsToOpen",10);
		GLR1 FHIJK 1;
		GLR1 L 1 A_Overlay(2,"ReloadSmoke");
		TNT1 A 0
		{
			if(invoker.thermiteGrenades)
			{
				A_FireProjectile("GrenadeCasingSpawner2",0,0,-4, -14);
			}
			else
			{
				A_FireProjectile("GrenadeCasingSpawner",0,0,-4, -14);
			}
			A_StartSound("foley/GLEjectShell",11);
			A_StartSound("Weapons/GrenadeOpen");
		}
		GLR1 MN 1 A_FireProjectile("SmokeSpawner",0,0,0,-1);
		GLR1 O 1 A_FireProjectile("SmokeSpawner",0,0,0,2);
		GLR1 PP 1 A_FireProjectile("SmokeSpawner",0,0,0,3);
		GLR4 A 0 A_JumpIf(invoker.thermiteGrenades, 2);
		GLR1 A 0;
		"####" QRSTUU 1;
		"####" W 1 {A_ReloadMag(); A_StartSound("Weapons/GrenadeLoad");}
		GLR1 XYZ 1;
		GLR2 A 1 A_GiveInventory("QuickSwitchSSG",1);
		TNT1 A 2 A_WeaponReady(WRF_NOFIRE);
		TNT1 A 0 A_StartSound("foley/GLUpwardsToClose",10);
		GLSA E 1 A_TakeInventory("QuickSwitchSSG",1);
		TNT1 A 0 A_StartSound("Weapons/GrenadeClose");
		GLSA EDCB 1 A_WeaponReady(WRF_NOFIRE);
		GLR3 M 1 A_WeaponReady(WRF_NOFIRE);
		Goto StrapIdle;
	ReloadHaste:
		GLR1 ACEGG 1;
		TNT1 A 0 A_StartSound("foley/GLDownwardsToOpen",10);
		GLR1 FIK 1;
		GLR1 L 1 A_Overlay(2,"ReloadSmoke");
		TNT1 A 0
		{
			if(invoker.thermiteGrenades)
			{
				A_FireProjectile("GrenadeCasingSpawner2",0,0,-4, -14);
			}
			else
			{
				A_FireProjectile("GrenadeCasingSpawner",0,0,-4, -14);
			}
			A_StartSound("foley/GLEjectShell",11);
			A_StartSound("Weapons/GrenadeOpen");
		}
		GLR1 N 1 A_FireProjectile("SmokeSpawner",0,0,0,-1);
		GLR1 O 1 A_FireProjectile("SmokeSpawner",0,0,0,2);
		GLR1 P 1 A_FireProjectile("SmokeSpawner",0,0,0,3);
		GLR4 A 0 A_JumpIf(invoker.thermiteGrenades, 2);
		GLR1 A 0;
		"####" RTU 1;
		"####" W 1 {A_ReloadMag(0,false,true); A_StartSound("Weapons/GrenadeLoad");}
		GLR1 Y 1;
		GLR2 A 1 A_GiveInventory("QuickSwitchSSG",1);
		TNT1 A 1 A_WeaponReady(WRF_NOFIRE);
		TNT1 A 0 A_StartSound("foley/GLUpwardsToClose",10);
		GLSA E 1 A_TakeInventory("QuickSwitchSSG",1);
		TNT1 A 0 A_StartSound("Weapons/GrenadeClose");
		GLSA DB 1 A_WeaponReady(WRF_NOFIRE);
		GLR3 M 1 A_WeaponReady(WRF_NOFIRE);
		Goto StrapIdle;
	SpecialAction:
		TNT1 A 0 A_JumpIfInventory("PowerSpeed2",1,"SpecialActionHaste");
		GLR1 ABCDEFGGGG 1;
		TNT1 A 0 A_StartSound("foley/GLDownwardsToOpen",10);
		GLR1 FHIJKL 1;
		TNT1 A 0 A_StartSound("Weapons/GrenadeOpen");
		GLR1 MNOPP 1;
		GLR1 A 0 A_jumpif(invoker.thermiteGrenades, 2);
		GLR4 A 0;
		"####" QRSTUU 1;
		"####" W 1
		{
			if(invoker.thermiteGrenades)
			{
				ChangeAmmoIcon1("ROCKA0");
				invoker.thermiteGrenades = 0;
				A_Print("\cgHigh Explosive Grenades",2);
			}
			else
			{
				ChangeAmmoIcon1("ROCKE0");
				invoker.thermiteGrenades = 1;
				A_Print("\cdThermite Grenades",2);
			}
			A_StartSound("Weapons/GrenadeLoad");
		}
		GLR1 XYZ 1;
		GLR2 A 1;
		TNT1 A 2;
		TNT1 A 0 A_StartSound("foley/GLUpwardsToClose",10);
		GLSA E 1;
		TNT1 A 0 A_StartSound("Weapons/GrenadeClose");
		GLSA EDCB 1;
		GLR3 M 1;
		Goto StrapIdle;
	SpecialActionHaste:
		GLR1 ACEGG 1;
		TNT1 A 0 A_StartSound("foley/GLDownwardsToOpen",10);
		GLR1 FIK 1;
		TNT1 A 0 A_StartSound("Weapons/GrenadeOpen");
		GLR1 NOP 1;
		GLR1 A 0 A_jumpif(invoker.thermiteGrenades, 2);
		GLR4 A 0;
		"####" RTU 1;
		"####" W 1
		{
			if(invoker.thermiteGrenades)
			{
				ChangeAmmoIcon1("ROCKA0");
				invoker.thermiteGrenades = 0;
				A_Print("\cgHigh Explosive Grenades",2);
			}
			else
			{
				ChangeAmmoIcon1("ROCKE0");
				invoker.thermiteGrenades = 1;
				A_Print("\cdThermite Grenades",2);
			}
			A_StartSound("Weapons/GrenadeLoad");
		}
		GLR1 Y 1;
		GLR2 A 1;
		TNT1 A 1;
		TNT1 A 0 A_StartSound("foley/GLUpwardsToClose",10);
		GLSA E 1;
		TNT1 A 0 A_StartSound("Weapons/GrenadeClose");
		GLSA DB 1;
		GLR3 M 1;
		Goto StrapIdle;
	Fidget:
		GLR1 ABCDEFGGGG 1 A_WeaponReadyDX(0,false,false);
		TNT1 A 0 A_StartSound("foley/GLDownwardsToOpen",10);
		GLR1 FHIJK 1 A_WeaponReadyDX(0,false,false);
		GLR2 L 1 A_WeaponReadyDX(0,false,false);
		TNT1 A 0 A_StartSound("Weapons/GrenadeOpen");
		GLR2 MN 1 A_WeaponReadyDX(0,false,false);
		GLR2 O 1 A_WeaponReadyDX(0,false,false);
		GLR2 P 11 A_WeaponReadyDX(0,false,false);
	FidgetLoop:
		GLR2 P 1 A_WeaponReadyDX(0,false,false);
		TNT1 A 0 A_JumpIf(GetPressed(BT_RELOAD),"FidgetLoop");
		GLR2 QR 1 A_WeaponReadyDX(0,false,false);
		GLR2 S 1 A_WeaponReadyDX(0,false,false);
		TNT1 A 2 A_WeaponReadyDX(0,false,false);
		TNT1 A 0 A_StartSound("foley/GLUpwardsToClose",10);
		GLSA E 1 A_WeaponReadyDX(0,false,false);
		TNT1 A 0 A_StartSound("Weapons/GrenadeClose");
		GLSA EDCB 1 A_WeaponReadyDX(0,false,false);
		GLR3 M 1 A_WeaponReadyDX(0,false,false);
		Goto StrapIdle;
	NoAmmo:
		TNT1 A 0 A_StartSound("weapons/empty", 3);
	NoAmmo2:
		TNT1 A 0 A_AutoReloadMag(1,"Reload",true);
		GLAN A 1 A_WeaponReadyDX(WRF_NOFIRE);
		TNT1 A 0 A_JumpIf(GetPressed(BT_RELOAD) || GetPressed(BT_ATTACK), "NoAmmo2");
		Goto Ready;
	Spawn:
		GLAP A -1;
		Stop;
	/*FireSticky:
		TNT1 A 0 A_TakeAmmo("GLAmmo", 1)
		TNT1 A 0 A_FireProjectile("BlueFlareSpawn",-5,0,0,0)
		TNT1 AAAAA 0 BRIGHT A_FireProjectile("ShotgunParticles", random(-12,12), 0, -1, 0, 0, random(-9,9))
		TNT1 AA 0 BRIGHT A_FireProjectile("ShotgunParticles2", random(-12,12), 0, -1, 0, 0, random(-9,9))
		TNT1 A 0 A_StartSound("weapons/firegrenade", 1)
		TNT1 A 0 A_FireProjectile("GrenadeMissileBreaksGlass", 0, 0, 0, 0)
		TNT1 A 0 A_ZoomFactor(0.98)
	//	TNT1 A 0 A_Recoil(2*cos(pitch))
	SHTZ A 0 
		{
		A_Recoil(1*cos(pitch));
			if(momZ != 0)
			{
			ThrustThingZ(0,pitch/3,0,1);
			}
		else
			{
			ThrustThingZ(0,pitch/4,0,1);
			}
		}
		GL2F A 1 BRIGHT 
		{
		A_ZoomFactor(1.0);
		//A_print("BEQUEATH");
		//A_FireProjectile("ShortGrenade", 0, 0, 0, 0);
	A_FireProjectile("leadburster", 0, 0, 0, 0);
		A_SetPitch(pitch-10, SPF_INTERPOLATE);
		}
		GL2F F 1 BRIGHT A_SetPitch(2 + pitch, SPF_INTERPOLATE)
		GLAF EDCB 1 A_SetPitch(2 + pitch, SPF_INTERPOLATE)
		GLR3 C 1
		GLAN A 2 A_jumpIfInventory("PowerSPeed2",1,"ready")
		Goto NoAmmo2
		
	AltFire:
		TNT1 A 0
		TNT1 A 0 A_CheckIfAmmo("GLAmmo")
		TNT1 A 0
		TNT1 A 0 A_TakeAmmo("GLAmmo", 1)
		//TNT1 A 0 A_jumpif(Countinv("StickyGrenadeSelected")==1, "altfiresticky")
		TNT1 A 0 A_FireProjectile("RedFlareSpawn",-5,0,0,0)
		TNT1 AAAAA 0 BRIGHT A_FireProjectile("ShotgunParticles", random(-12,12), 0, -1, 0, 0, random(-9,9))
		TNT1 AA 0 BRIGHT A_FireProjectile("ShotgunParticles2", random(-12,12), 0, -1, 0, 0, random(-9,9))
		TNT1 A 0 A_StartSound("weapons/firegrenade", 1)
		TNT1 A 0 A_FireProjectile("GrenadeMissileBreaksGlass", 0, 0, 0, 0)
		TNT1 A 0 A_ZoomFactor(0.98)
	//	TNT1 A 0 A_Recoil(2*cos(pitch))
	SHTZ A 0 
		{
		A_Recoil(1*cos(pitch));
			if(momZ != 0)
			{
			ThrustThingZ(0,pitch/3,0,1);
			}
		else
			{
			ThrustThingZ(0,pitch/4,0,1);
			}
		}
		GLAF A 1 BRIGHT 
		TNT1 A 0 A_ZoomFactor(1.0)
		TNT1 A 0 
		{
		If(Countinv("StickyGrenadeSelected")==1)
		{
			A_FireProjectile("FireGrenade2", 0, 0, 0, 0);
		}
		Else
		{
		A_FireProjectile("GrenadeMissile", 0, 1, 0, 0);
		}
		}
		TNT1 A 0 A_SetPitch(pitch-10, SPF_INTERPOLATE)
		GLAF F 1 BRIGHT A_SetPitch(2 + pitch, SPF_INTERPOLATE)
		GLAF EDCB 1 A_SetPitch(2 + pitch, SPF_INTERPOLATE)
		GLR3 C 1
		GLAN A 2 A_jumpIfInventory("PowerSPeed2",1,"ready")
		Goto NoAmmo2
		
		AltFireSticky:
		TNT1 A 0 A_FireProjectile("BlueFlareSpawn",-5,0,0,0)
		TNT1 AAAAA 0 BRIGHT A_FireProjectile("ShotgunParticles", random(-12,12), 0, -1, 0, 0, random(-9,9))
		TNT1 AA 0 BRIGHT A_FireProjectile("ShotgunParticles2", random(-12,12), 0, -1, 0, 0, random(-9,9))
		TNT1 A 0 A_StartSound("weapons/firegrenade", 1)
		TNT1 A 0 A_FireProjectile("GrenadeMissileBreaksGlass", 0, 0, 0, 0)
		TNT1 A 0 A_ZoomFactor(0.98)
	//	TNT1 A 0 A_Recoil(2*cos(pitch))
	SHTZ A 0 
		{
		A_Recoil(1*cos(pitch));
			if(momZ != 0)
			{
			ThrustThingZ(0,pitch/3,0,1);
			}
		else
			{
			ThrustThingZ(0,pitch/4,0,1);
			}
		}
		GL2F A 1 BRIGHT 
		TNT1 A 0 A_ZoomFactor(1.0)
		TNT1 A 0 A_FireProjectile("StickyGrenadeBouncy", 0, 1, 0, 0)
		TNT1 A 0 A_SetPitch(pitch-10, SPF_INTERPOLATE)
		GL2F F 1 BRIGHT A_SetPitch(2 + pitch, SPF_INTERPOLATE)
		GLAF EDCB 1 A_SetPitch(2 + pitch, SPF_INTERPOLATE)
		GLR3 C 1
		GLAN A 2 A_jumpIfInventory("PowerSPeed2",1,"ready")
		Goto NoAmmo2
		*/
	}
}

Class GrenadeDetonates : Actor
{
	Default
	{
	Radius 4;
	Height 4;
	Speed 50;
	Damagefunction 60;
	+MISSILE;
	Gravity 0.7;
	+SKYEXPLODE;
	+BOUNCEONFLOORS;
	+BOUNCEONWALLS;
	+BOUNCEONCEILINGS;
	+bounceonactors;
	+EXPLODEONWATER;
	+THRUSPECIES;
	+BOUNCEAUTOOFFFLOORONLY;
	+usebouncestate;
	Species "Marines";
	DamageType "Kick";
	BounceFactor 0.5;
	WallBounceFactor 0.35;
	BounceSound "Weapons/GrenadeBounce";
	DeathSound "Weapons/GrenadeBounce";
	Decal "Scorch";
	Obituary "$OB_MPROCKET";
	Scale 0.7;
	}
	States
	{
	Spawn:
		GBPJ AAABBBCCC 1 
		{
			A_SpawnProjectile ("RocketSmokeTrail52", 2, 0, random (70, 110), 2, random (0, 360));
			//A_SpawnItemEX("RocketFlare");
		}
		Goto bounce;
	Spawn2:
		GBPJ AAABBBCCCDDDEEEFFFGGGHHH 1 
		{
			A_SpawnItemEX("GrenadeFlare");
			A_SpawnProjectile ("RocketSmokeTrail52", 2, 0, random (70, 110), 2, random (0, 360));
			If(target && target.player && target.player.cmd.buttons & BT_ATTACK)
			{
				Return resolvestate(null);
			}
			Else
			{
				Return resolvestate("Explode");
			}
		}
		Loop;
	Bounce:
		TNT1 A 0
		{
			If(target && target.player && target.player.cmd.buttons & BT_ATTACK)
			{
				Return resolvestate("spawn2");
			}
			Else
			{
				Return resolvestate("Explode");
			}
		}
	Death:
	Xdeath:

		GBPJ AAAA 1 
		{
			A_SpawnItemEX("GrenadeFlare");
			A_SpawnProjectile ("RocketSmokeTrail52", 2, 0, random (70, 110), 2, random (0, 360));
			If(target && target.player && target.player.cmd.buttons & BT_ATTACK)
			{
				Return resolvestate(null);
			}
			Else
			{
				Return resolvestate("Explode");
			}
		
		}
		Loop;
	
	Explode:
		TNT1 A 0 A_stopsound(7);
		TNT1 A 0 A_StartSound("Explosion", 1);
		EXPL A 0 Radius_Quake (8, 8, 0, 128, 0);//(intensity, duration, damrad, tremrad, tid)
		TNT1 A 0 A_SpawnItemEx ("GrenadeExplosion",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0);
	   TNT1 A 0 A_spawnitemex("ricochetexplosion");
		TNT1 AAAAAAAAAA 0 A_spawnProjectile ("BDExplosionparticlesBig", 0, 0, random (0, 360), 2, random (0, 360));
		TNT1 AAAAAAA 0 A_SpawnProjectile ("BDExplosionparticles2", 0, 0, random (0, 360), 2, random (0, -90));
	   	TNT1 AAAA 0 A_spawnProjectile ("SmallExplosionFlames", 0, 0, random (0, 360), 2, random (0, 360))  ;
		TNT1 AAAAAAA 0 A_SpawnProjectile ("ExplosionFlames", 0, 0, random (0, 360), 2, random (0, 360));
		TNT1 AAAAAAAAAAAAAA 0 A_SpawnProjectile ("ExplosionParticleHeavy", 0, 0, random (0, 360), 2, random (0, -180));
		TNT1 AAAAAA 0 A_SpawnProjectile ("ExplosionParticleHeavy", 0, 0, random (0, 180), 2, random (0, 180));
		TNT1 A 0 A_StartSound("FAREXPL", 3);
	//	TNT1 AAAAAAAAAA 4 A_CustomMissile ("ExplosionSmoke", 1, 0, random (0, 360), 2, random (50, 130))
		TNT1 A 0 A_SpawnProjectile ("ExplosionSmoke", 1, 0, random (0, 360), 2, random (-50, -130));
		stop;
	}
}

CLASS FireGrenade : actor
{
	Default
	{
	Radius 4;
	Height 4;
	Speed 30;


  //  +BLOODSPLATTER
	Gravity 0.7;
	Damagefunction 0;
	+MISSILE;
	+FORCEXYBILLBOARD;
	+rollsprite;
	+ROLLCENTER;
	//+bloodlessimpact;
	//+BLOODSPLATTER;
	//+ripper;
	Obituary "%o was stuck by a freeze grenade";
	//SeeSound "weapons/chainsaw/loop"
	//+ripper
	+hittracer;
	+explodeonwater;
	+usebouncestate;
	+skyexplode;
	+bounceonwalls;
+bounceonfloors;
+bounceonceilings;
bouncecount 5;
-explodeonwater;
+canbouncewater;
BounceSound "Weapons/GrenadeBounce";
	}
	

		
	
	Vector3 stickOfs;
	double stickAngle;
	
	int sawtimer;
	int sawtimer2;
	bool hasexploded;
	bool stuck;
	bool ihitsomething;
	
	Override void tick()
	{
		Super.tick();
		A_spawnprojectile("SmallFlameTrails", 0, 0, random (0, 360), 2, random (-70, -110));
		A_spawnprojectile("firegrenade_debris", 0, 0, random (0, 360), 2, random (0, 360));
		A_spawnprojectile("firegrenade_debris", 0, 0, random (0, 360), 2, random (0, 360));
		A_spawnprojectile("firegrenade_debris", 0, 0, random (0, 360), 2, random (0, 360));
		sawtimer++;
		sawtimer2++;
		If(sawtimer >= 10)
		{
			sawtimer = 0;
			If(tracer && target)
			{
				
				tracer.damagemobj(Self,Target,15,"Fire");
				
			}
			A_explode(15,200,XF_HURTSOURCE | XF_THRUSTLESS, false, DAMAGETYPE: "Fire");
		}
		If(sawtimer2 >= 245)
		{
			A_stopsound(4);
			Destroy();
		}
	
	}
	
	
	Override void beginplay()
		{
		//tracer = null;
		super.beginplay();
		//savedangle = angle;
		}
	
	
	States
	{
	Spawn:
		GBPJ AAABBBCCCDDDEEEFFFGGGHHH 1
		{
		A_startsound("THRMT",4,CHANF_LOOPING);
		//savedheight = floorz;
		tracer = null;
		}
		Loop;
		
		
		

		Xdeath:
		TNT1 A 0;
		//TNT1 A 0 A_startsound("StickyGrenade/Hit");
		TNT1 A 0 
		{
		ihitsomething = true;
		stuck = true;
		//tracer = victim;
			If(tracer)
			{
				tracer.a_pain();
				stickOfs = tracer.Vec3To(self);
					stickAngle = tracer.angle;
		busebouncestate = false;
		}
		If(!tracer)
		{
		setstatelabel("Death");
		}
		}
		Stuck:
		GBPJ A 1 
		{
		
		If(!tracer || tracer.health < 1)
		{
		setstatelabel("Death");
		}


			If(tracer && tracer.health > 0)
			{
			/*
			If(tracer.health < 200 && !tracer.findinventory("melee_attacks"))
			{
			//tracer.angle = (tracer.angle + frandom(-40,40));
		//	tracer.a_stop();
		//	tracer.a_recoil(-7);
			tracer.reactiontime = 10;
			}
			*/
			
				double angDiff = DeltaAngle(stickAngle, tracer.angle);
					if (angDiff)
					{
						stickOfs.xy = RotateVector(stickOfs.xy, angDiff);
						angle += angDiff;
					}

				SetOrigin(tracer.Vec3Offset(stickOfs.x, stickOfs.y, stickOfs.z), true);
				stickAngle = tracer.angle;
				//tracer.a_stop();
			
				//Warp(tracer,calculatingpos.x,calculatingpos.y,calculatedpos.z,savedangle,WARPF_NOCHECKPOSITION | WARPF_ABSOLUTEANGLE | WARPF_INTERPOLATE | WARPF_TOFLOOR);
				//angle = savedangle;
			}
		
			
		}
		LOOP;
		
		death:
		TNT1 A 0 
		{
		ihitsomething = true;
		//A_startsound("StickyGrenade/Hit");
		tracer = null;
		}
		
		TNT1 A 0
		{
		busebouncestate = false;
		bnogravity = true;
		}
		StayDead:
		GBPJ A 1;
		LOOP;
		

		
		
	
	ExplodeTime:
	TNT1 A 0;
		TNT1 A 10;
		stop;
		
	Fall:
		 //AXEG A 0 A_SpawnItemEX("Sparks");
		//AXEG A 0 A_startSound("AXECLN", 6);
		TNT1 A 0
		{
		tracer = null;
		bnogravity = false;
		}
	Goto Deathfloor;
	
	
	Bounce:
	TNT1 A 0
	{
	tracer = null;
	bhitowner = TRUE;
	}
	Goto spawn;
	
	}
}

Class FireGrenade_Debris : Actor
{
	Default
	{
	height 1;
	radius 1;
	mass 0;
	speed 3;
	+CLIENTSIDEONLY;
	+MISSILE +NOBLOCKMAP +DOOMBOUNCE;
	bouncefactor 0.3;
	renderstyle "Add";
	scale 0.03;
	Gravity 0.8;
  }
  
  Override void beginplay()
  {
	Speed = frandom(4,20);
	float potentialscale = frandom(0.01,0.05);
	A_setscale(potentialscale,potentialscale);
	Super.beginplay();
  }
  states
  {
  Spawn:
	SPRK A random(1,10) bright;
  Death:
	SPRK A 1 bright A_FadeOut (0.1);
	loop;


  }
}